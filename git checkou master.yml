- name: Checkout do Git
  hosts: all
  become: yes
  tasks:
    - name: Realizar checkout inicial e verificar branch
      shell: | 
        cd /var/www/html/iptell/ && git checkout .
      register: checkout_master
      ignore_errors: yes

    - name: Exibir comando e saída do checkout inicial
      debug:
        msg: |
          Comando: cd /var/www/html/iptell/ && git checkout .
          Saída: "{{ checkout_master.stdout }}"
    
    - name: Verificar se o branch
      set_fact:
        branch_up_to_date: >
          {% if "Already on 'master'" in checkout_master.stdout and
             "Your branch is up to date with 'origin/master'" in checkout_master.stdout %}
            true
          {% else %}
            false
          {% endif %}

    - name: Realizar checkout Master se necessário
      shell: git checkout master
      when: not branch_up_to_date
      register: final_checkout
      ignore_errors: yes

    - name: Exibir comando e saída do checkout master
      debug:
        msg: |
          Comando: git checkout master
          Saída: "{{ final_checkout.stdout }}"
      when: not branch_up_to_date
