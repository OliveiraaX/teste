---
- name: Verificar versão do Node.js
  hosts: all
  become: yes

  tasks:
    - name: Executar comando node -v
      shell: node -v
      register: node_version

    - name: Mostrar a versão do Node.js
      debug:
        msg: "A versão do Node.js é: {{ node_version.stdout }}"

    - name: Extrair partes da versão do Node.js
      set_fact:
        node_version_string: "{{ node_version.stdout | regex_replace('^v', '') }}"
        major: "{{ node_version_string.split('.')[0] | int }}"
        minor: "{{ node_version_string.split('.')[1] | int }}"
        patch: "{{ node_version_string.split('.')[2] | int }}"

    - name: Verificar se a versão do Node.js é maior ou igual a 18.10.0
      fail:
        msg: "A versão do Node.js é inferior a 18.10.0. A versão atual é: {{ node_version.stdout }}"
      when: >
        {{
          (major < 18) or
          (major == 18 and minor < 10) or
          (major == 18 and minor == 10 and patch < 0)
        }}
